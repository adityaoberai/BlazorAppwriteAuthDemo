@page "/config"
@rendermode InteractiveServer
@inject IConfiguration Configuration
@inject IWebHostEnvironment Environment

<PageTitle>Configuration Check</PageTitle>

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0">Appwrite Configuration Status</h3>
                    <small>Diagnostic page - Do not share this publicly</small>
                </div>
                <div class="card-body">
                    <!-- Environment Info -->
                    <div class="mb-4">
                        <h5 class="border-bottom pb-2">Environment Information</h5>
                        <table class="table table-sm">
                            <tbody>
                                <tr>
                                    <td><strong>Environment Name:</strong></td>
                                    <td><span class="badge bg-info">@Environment.EnvironmentName</span></td>
                                </tr>
                                <tr>
                                    <td><strong>Is Development:</strong></td>
                                    <td>@Environment.IsDevelopment()</td>
                                </tr>
                                <tr>
                                    <td><strong>Is Production:</strong></td>
                                    <td>@Environment.IsProduction()</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Appwrite Configuration -->
                    <div class="mb-4">
                        <h5 class="border-bottom pb-2">Appwrite Configuration</h5>
                        <table class="table table-striped table-sm">
                            <thead>
                                <tr>
                                    <th>Setting</th>
                                    <th>Status</th>
                                    <th>Value</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Endpoint</strong></td>
                                    <td>
                                        @if (string.IsNullOrEmpty(endpoint))
                                        {
                                            <span class="badge bg-danger">❌ Not Set</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-success">✅ Set</span>
                                        }
                                    </td>
                                    <td><code>@(endpoint ?? "NOT CONFIGURED")</code></td>
                                </tr>
                                <tr>
                                    <td><strong>Project ID</strong></td>
                                    <td>
                                        @if (string.IsNullOrEmpty(projectId))
                                        {
                                            <span class="badge bg-danger">❌ Not Set</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-success">✅ Set</span>
                                        }
                                    </td>
                                    <td><code>@(projectId ?? "NOT CONFIGURED")</code></td>
                                </tr>
                                <tr>
                                    <td><strong>API Key</strong></td>
                                    <td>
                                        @if (string.IsNullOrEmpty(apiKey))
                                        {
                                            <span class="badge bg-danger">❌ Not Set</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-success">✅ Set</span>
                                        }
                                    </td>
                                    <td>
                                        @if (!string.IsNullOrEmpty(apiKey))
                                        {
                                            <code>@(apiKey.Substring(0, Math.Min(10, apiKey.Length)))...***</code>
                                            <small class="text-muted">(hidden for security)</small>
                                        }
                                        else
                                        {
                                            <code>NOT CONFIGURED</code>
                                        }
                                    </td>
                                </tr>
                                <tr>
                                    <td><strong>Database ID</strong></td>
                                    <td>
                                        @if (string.IsNullOrEmpty(databaseId))
                                        {
                                            <span class="badge bg-danger">❌ Not Set</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-success">✅ Set</span>
                                        }
                                    </td>
                                    <td><code>@(databaseId ?? "NOT CONFIGURED")</code></td>
                                </tr>
                                <tr>
                                    <td><strong>Todos Collection ID</strong></td>
                                    <td>
                                        @if (string.IsNullOrEmpty(todosCollectionId))
                                        {
                                            <span class="badge bg-danger">❌ Not Set</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-success">✅ Set</span>
                                        }
                                    </td>
                                    <td><code>@(todosCollectionId ?? "NOT CONFIGURED")</code></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Configuration Status Summary -->
                    <div class="alert @(allConfigured ? "alert-success" : "alert-danger")" role="alert">
                        @if (allConfigured)
                        {
                            <h5 class="alert-heading">✅ All Configuration Values Are Set</h5>
                            <p class="mb-0">Your Appwrite configuration appears to be complete.</p>
                        }
                        else
                        {
                            <h5 class="alert-heading">❌ Configuration Issues Detected</h5>
                            <p class="mb-0">Some configuration values are missing. Please check your Azure App Service Application Settings.</p>
                            <hr />
                            <p class="mb-0"><strong>Expected Azure Settings:</strong></p>
                            <ul class="mb-0 mt-2">
                                <li><code>Appwrite__Endpoint</code></li>
                                <li><code>Appwrite__ProjectId</code></li>
                                <li><code>Appwrite__ApiKey</code></li>
                                <li><code>Appwrite__DatabaseId</code></li>
                                <li><code>Appwrite__TodosCollectionId</code></li>
                            </ul>
                        }
                    </div>

                    <!-- Warning -->
                    <div class="alert alert-warning mt-4" role="alert">
                        <strong>⚠️ Security Warning:</strong> This page shows configuration details. 
                        Remove or restrict access to this page in production. Access it at: <code>/config</code>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    private string? endpoint;
    private string? projectId;
    private string? apiKey;
    private string? databaseId;
    private string? todosCollectionId;
    private bool allConfigured;

    protected override void OnInitialized()
    {
        // Read configuration values
        endpoint = Configuration["Appwrite:Endpoint"];
        projectId = Configuration["Appwrite:ProjectId"];
        apiKey = Configuration["Appwrite:ApiKey"];
        databaseId = Configuration["Appwrite:DatabaseId"];
        todosCollectionId = Configuration["Appwrite:TodosCollectionId"];

        // Check if all are configured
        allConfigured = !string.IsNullOrEmpty(endpoint) &&
                       !string.IsNullOrEmpty(projectId) &&
                       !string.IsNullOrEmpty(apiKey) &&
                       !string.IsNullOrEmpty(databaseId) &&
                       !string.IsNullOrEmpty(todosCollectionId);
    }
}
